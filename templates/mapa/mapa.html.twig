{% extends 'base.html.twig' %}

{% block title %}Mapa interactivo{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
{{ encore_entry_link_tags('mapa') }}
{{ encore_entry_link_tags('app') }}
{% endblock %}

{% block content %}
<div class="titulo-mapa">
<h1>Mapa Interactivo</h1>
</div>
<div id="map"></div>
{% endblock %}

{% block javascripts %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

    // Inicializar el mapa centrado en La Plata
    const map = L.map('map').setView([-34.9214, -57.9544], 12);

    // Capa base OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Pines precargados (vacío por ahora)
    const pins = {{ pins|json_encode|raw|default('[]') }};

    // Mostrar pines existentes (ninguno por ahora)
    pins.forEach(pin => {
        const marker = L.marker([pin.lat, pin.lng], { draggable: true }).addTo(map);
        marker.bindPopup(`<b>${pin.title}</b><br>Lat: ${pin.lat.toFixed(5)}, Lng: ${pin.lng.toFixed(5)}
                          <br><button onclick="map.removeLayer(marker)">Eliminar</button>`);
    });

    // Agregar nuevo pin al hacer clic en el mapa
    map.on('click', function(e) {
        const marker = L.marker([e.latlng.lat, e.latlng.lng], { draggable: true }).addTo(map);
        marker.bindPopup(`<b>Nuevo Pin</b><br>Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}
                          <br><button onclick="map.removeLayer(marker)">Eliminar</button>`);
    });

});
</script>
{% endblock %}
